<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‘æˆ˜ç³»ç»Ÿæ¨¡å—åŒ–ç»„è£…æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(245,247,250,0.95) 100%);
            z-index: -1;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 30px;
            font-size: 36px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* å·¦ä¾§æ¨¡å—é€‰æ‹©åŒº */
        .modules-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #e8ecf1;
        }
        
        .module-category {
            margin-bottom: 20px;
        }
        
        .module-category h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .module-item {
            background: linear-gradient(135deg, #f8f9fb 0%, #ffffff 100%);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.3s;
            border: 1px solid #e8ecf1;
            position: relative;
            overflow: hidden;
        }
        
        .module-item::before {
            content: 'â‹®â‹®';
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            color: #cbd5e0;
            font-size: 10px;
            letter-spacing: -2px;
        }
        
        .module-item:hover {
            background: linear-gradient(135deg, #eef2f7 0%, #f0f7ff 100%);
            border-color: #4a90e2;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.15);
        }
        
        .module-item.dragging {
            opacity: 0.5;
        }
        
        .module-tag {
            display: inline-block;
            padding: 3px 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 10px;
            margin-left: 8px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
        }
        
        /* ä¸­é—´ç»„è£…åŒº */
        .assembly-area {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e8ecf1;
        }
        
        .assembly-title {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .clear-btn {
            background: white;
            color: #ef4444;
            border: 2px solid #fee2e2;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .clear-btn:hover {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: transparent;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);
        }
        
        /* å›ºå®šæ¡†æ¶ */
        .fixed-framework {
            background: linear-gradient(135deg, #f0f4ff 0%, #f8f9fb 100%);
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .fixed-framework::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            z-index: -1;
        }
        
        .framework-label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 13px;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        
        .slot {
            background: white;
            border: 2px dashed #b8d4f1;
            border-radius: 6px;
            min-height: 60px;
            padding: 10px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s;
        }
        
        .slot.drag-over {
            background: #f0f7ff;
            border-color: #4a90e2;
        }
        
        /* æ‹–åŠ¨æ—¶é«˜äº®åŒ¹é…çš„æ’æ§½ */
        .slot.highlight-guide {
            background: linear-gradient(45deg, #e8f4fd 25%, #f0f7ff 25%, #f0f7ff 50%, #e8f4fd 50%, #e8f4fd 75%, #f0f7ff 75%, #f0f7ff);
            background-size: 20px 20px;
            animation: guideMove 1s linear infinite;
            border-color: #4a90e2;
            box-shadow: 0 0 15px rgba(74, 144, 226, 0.3);
        }
        
        @keyframes guideMove {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 20px 20px;
            }
        }
        
        .slot-label {
            position: absolute;
            top: -10px;
            left: 10px;
            background: white;
            padding: 0 5px;
            color: #4a90e2;
            font-size: 12px;
            font-weight: 500;
        }
        
        .slot-placeholder {
            color: #999;
            text-align: center;
            line-height: 40px;
            font-style: italic;
        }
        
        .inserted-module {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px;
            border-radius: 8px;
            margin: 5px 0;
            position: relative;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .remove-module {
            position: absolute;
            right: 5px;
            top: 5px;
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        
        .remove-module:hover {
            background: rgba(255,0,0,0.5);
        }
        
        /* å³ä¾§é…ç½®å±•ç¤º */
        .config-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e8ecf1;
        }
        
        .config-title {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .config-content {
            background: #f8f9fb;
            color: #2c3e50;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e8ecf1;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        /* è¿è¡ŒæŒ‰é’® */
        .run-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .run-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .run-btn:hover::before {
            left: 100%;
        }
        
        .run-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ç¤ºä¾‹é¢„è®¾ */
        .presets {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .preset-btn {
            background: white;
            border: 2px solid transparent;
            background-image: linear-gradient(white, white), linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-origin: border-box;
            background-clip: padding-box, border-box;
            color: #667eea;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
        }
        
        .preset-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
        }
        
        /* æç¤ºä¿¡æ¯ */
        .hint {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
            border: 1px solid rgba(102, 126, 234, 0.2);
            color: #4a5568;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
            position: relative;
            padding-left: 35px;
        }
        
        .hint::before {
            content: 'ğŸ’¡';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® æŒ‘æˆ˜ç³»ç»Ÿæ¨¡å—åŒ–ç»„è£…æ¼”ç¤º</h1>
        
        <div class="presets">
            <button class="preset-btn" onclick="loadPreset('love')">ğŸ’• æ‹çˆ±æŒ‘æˆ˜ç¤ºä¾‹</button>
            <button class="preset-btn" onclick="loadPreset('academic')">ğŸ“š å­¦æœ¯è¾©è®ºç¤ºä¾‹</button>
            <button class="preset-btn" onclick="loadPreset('workplace')">ğŸ’¼ èŒåœºè°ˆåˆ¤ç¤ºä¾‹</button>
            <button class="preset-btn" onclick="loadPreset('minimal')">ğŸ¯ æœ€ç®€é…ç½®ç¤ºä¾‹</button>
            <button class="preset-btn" onclick="clearAll()">ğŸ”„ æ¸…ç©ºé‡ç½®</button>
        </div>
        
        <div class="main-layout">
            <!-- å·¦ä¾§ï¼šå¯é€‰æ¨¡å— -->
            <div class="modules-panel">
                <h2 style="margin-bottom: 15px; color: #333;">å¯é€‰æ¨¡å—</h2>
                <div class="hint">
                    æ‹–æ‹½æ¨¡å—åˆ°ä¸­é—´çš„æ’æ§½ä¸­<br>
                    <span style="color: #999;">æ‰€æœ‰æ’æ§½éƒ½æ˜¯å¯é€‰çš„ï¼Œå›ºå®šæ¡†æ¶ä¸ºå¿…å¡«é¡¹</span>
                </div>
                
                <div class="module-category">
                    <h3>â± é™åˆ¶æ¡ä»¶ç±»å‹</h3>
                    <div class="module-item" draggable="true" data-type="limit" data-value='{"type":"time"}'>
                        æ—¶é—´é™åˆ¶ <span class="module-tag">è®¡æ—¶</span>
                    </div>
                    <div class="module-item" draggable="true" data-type="limit" data-value='{"type":"round"}'>
                        è½®æ¬¡é™åˆ¶ <span class="module-tag">è®¡è½®</span>
                    </div>
                </div>
                
                <div class="module-category">
                    <h3>ğŸ¯ æŒ‘æˆ˜ç›®æ ‡ç±»å‹</h3>
                    <div class="module-item" draggable="true" data-type="goal" data-value='{"type":"è¯´å‡ºè¯è¯­"}'>
                        è¯´å‡ºæŒ‡å®šè¯è¯­ <span class="module-tag">è¯è¯­</span>
                    </div>
                    <div class="module-item" draggable="true" data-type="goal" data-value='{"type":"æ”¹å˜ç«‹åœº"}'>
                        æ”¹å˜æ•°å€¼ç«‹åœº <span class="module-tag">æ•°å€¼</span>
                    </div>
                    <div class="module-item" draggable="true" data-type="goal" data-value='{"type":"åšå‡ºè¡Œä¸º"}'>
                        åšå‡ºç‰¹å®šè¡Œä¸º <span class="module-tag">è¡Œä¸º</span>
                    </div>
                    <div class="module-item" draggable="true" data-type="goal" data-value='{"type":"åšå‡ºåˆ¤æ–­"}'>
                        åˆ¤æ–­çœŸå®æ„å›¾ <span class="module-tag">åˆ¤æ–­</span>
                    </div>
                </div>
                
                <div class="module-category">
                    <h3>ğŸ† å¥–åŠ±æœºåˆ¶ç±»å‹</h3>
                    <div class="module-item" draggable="true" data-type="reward" data-value='{"type":"è§£é”äººè®¾"}'>
                        è§£é”éšè—äººè®¾ <span class="module-tag">äººè®¾</span>
                    </div>
                    <div class="module-item" draggable="true" data-type="reward" data-value='{"type":"æ•…äº‹ç»“å±€"}'>
                        ç‰¹æ®Šæ•…äº‹ç»“å±€ <span class="module-tag">å‰§æƒ…</span>
                    </div>
                    <div class="module-item" draggable="true" data-type="reward" data-value='{"type":"æ•°å€¼è¾¾æˆ"}'>
                        æ•°å€¼æˆå°± <span class="module-tag">æˆå°±</span>
                    </div>
                </div>
                
                <div class="module-category">
                    <h3>âš”ï¸ å›é¿ç­–ç•¥</h3>
                    <div class="module-item" draggable="true" data-type="difficulty" data-value='{"strategy":""}'>
                        è®¾ç½®å›é¿ç­–ç•¥ <span class="module-tag">ç­–ç•¥</span>
                    </div>
                </div>
            </div>
            
            <!-- ä¸­é—´ï¼šç»„è£…åŒºåŸŸ -->
            <div class="assembly-area">
                <div class="assembly-title">
                    <h2>ç»„è£…åŒºåŸŸ</h2>
                    <button class="clear-btn" onclick="clearAll()">æ¸…ç©ºå…¨éƒ¨</button>
                </div>
                
                <div class="fixed-framework">
                    <div class="framework-label">ğŸ“ å›ºå®šæ¡†æ¶ï¼ˆæ‰€æœ‰æŒ‘æˆ˜éƒ½æœ‰ï¼‰</div>
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <label style="display: block; color: #4a5568; font-size: 13px; margin-bottom: 6px; font-weight: 500;">ğŸ­ è§’è‰²åç§°</label>
                        <input type="text" id="charName" value="" placeholder="è¾“å…¥è§’è‰²åç§°" 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; transition: all 0.3s;"
                               onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                               onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <label style="display: block; color: #4a5568; font-size: 13px; margin-bottom: 6px; font-weight: 500;">ğŸ¯ è§’è‰²ç«‹åœº</label>
                        <input type="text" id="charStance" value="" placeholder="æè¿°è§’è‰²çš„ç«‹åœºå’Œæ€åº¦" 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; transition: all 0.3s;"
                               onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                               onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <label style="display: block; color: #4a5568; font-size: 13px; margin-bottom: 6px; font-weight: 500;">ğŸ’¬ å¼€åœºç™½</label>
                        <input type="text" id="openingLine" value="" placeholder="è§’è‰²çš„å¼€åœºå°è¯" 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; transition: all 0.3s;"
                               onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                               onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <label style="display: block; color: #4a5568; font-size: 13px; margin-bottom: 6px; font-weight: 500;">ğŸ“ æŒ‘æˆ˜æ ‡é¢˜</label>
                        <input type="text" id="challengeTitle" value="" placeholder="5-15ä¸ªå­—çš„æ ‡é¢˜"
                               style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; transition: all 0.3s;"
                               onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                               onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <label style="display: block; color: #4a5568; font-size: 13px; margin-bottom: 6px; font-weight: 500;">ğŸ“– èƒŒæ™¯ä»‹ç»</label>
                        <textarea id="backgroundIntro" placeholder="60-80å­—è¯´æ˜æŒ‘æˆ˜èƒŒæ™¯"
                                  style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; min-height: 80px; resize: vertical; transition: all 0.3s;"
                                  onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                                  onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'"></textarea>
                    </div>
                </div>
                
                <div class="framework-label">ğŸ”§ å¯å˜ç»„ä»¶ï¼ˆæ‹–å…¥ä¸‹æ–¹æ’æ§½ï¼‰</div>
                
                <div class="slot" data-slot="limit">
                    <span class="slot-label">é™åˆ¶æ¡ä»¶æ’æ§½ <span style="color: #999;">(å¯é€‰)</span></span>
                    <div class="slot-placeholder">æ‹–å…¥é™åˆ¶ç±»å‹ï¼ˆå¯ä¸ºç©ºï¼‰</div>
                </div>
                
                <div class="slot" data-slot="goal">
                    <span class="slot-label">æŒ‘æˆ˜ç›®æ ‡æ’æ§½ <span style="color: #999;">(å¯é€‰)</span></span>
                    <div class="slot-placeholder">æ‹–å…¥ç›®æ ‡ç±»å‹ï¼ˆå¯ä¸ºç©ºï¼‰</div>
                </div>
                
                <div class="slot" data-slot="reward">
                    <span class="slot-label">å¥–åŠ±æœºåˆ¶æ’æ§½ <span style="color: #999;">(å¯é€‰)</span></span>
                    <div class="slot-placeholder">æ‹–å…¥å¥–åŠ±ç±»å‹ï¼ˆå¯ä¸ºç©ºï¼‰</div>
                </div>
                
                <div class="slot" data-slot="difficulty">
                    <span class="slot-label">å›é¿ç­–ç•¥æ’æ§½ <span style="color: #999;">(å¯é€‰)</span></span>
                    <div class="slot-placeholder">æ‹–å…¥å›é¿ç­–ç•¥è®¾ç½®ï¼ˆå¯ä¸ºç©ºï¼‰</div>
                </div>
                
                <button class="run-btn" onclick="generateConfig()">ğŸš€ ç”Ÿæˆé…ç½®</button>
            </div>
            
            <!-- å³ä¾§ï¼šé…ç½®è¾“å‡º -->
            <div class="config-panel">
                <h2 class="config-title">ğŸ“‹ ç”Ÿæˆçš„é…ç½®</h2>
                <div class="config-content" id="configOutput">
// é…ç½®å°†åœ¨è¿™é‡Œæ˜¾ç¤º
// æ‹–å…¥æ¨¡å—åç‚¹å‡»"ç”Ÿæˆé…ç½®"
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // æ‹–æ”¾åŠŸèƒ½
        let draggedElement = null;
        
        // ä¸ºæ‰€æœ‰å¯æ‹–åŠ¨æ¨¡å—æ·»åŠ äº‹ä»¶
        document.querySelectorAll('.module-item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                draggedElement = e.target;
                e.target.classList.add('dragging');
                
                // é«˜äº®å¯¹åº”çš„æ’æ§½
                const moduleType = e.target.dataset.type;
                const matchingSlot = document.querySelector(`[data-slot="${moduleType}"]`);
                if (matchingSlot) {
                    matchingSlot.classList.add('highlight-guide');
                }
            });
            
            item.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
                
                // ç§»é™¤æ‰€æœ‰æ’æ§½çš„é«˜äº®
                document.querySelectorAll('.slot').forEach(slot => {
                    slot.classList.remove('highlight-guide');
                });
            });
        });
        
        // ä¸ºæ‰€æœ‰æ’æ§½æ·»åŠ äº‹ä»¶
        document.querySelectorAll('.slot').forEach(slot => {
            slot.addEventListener('dragover', (e) => {
                e.preventDefault();
                slot.classList.add('drag-over');
            });
            
            slot.addEventListener('dragleave', (e) => {
                slot.classList.remove('drag-over');
            });
            
            slot.addEventListener('drop', (e) => {
                e.preventDefault();
                slot.classList.remove('drag-over');
                
                if (draggedElement) {
                    const slotType = slot.dataset.slot;
                    const moduleType = draggedElement.dataset.type;
                    
                    // æ£€æŸ¥ç±»å‹æ˜¯å¦åŒ¹é…
                    if (slotType === moduleType) {
                        const moduleData = JSON.parse(draggedElement.dataset.value);
                        insertModule(slot, draggedElement.textContent, moduleData);
                    } else {
                        alert('æ¨¡å—ç±»å‹ä¸åŒ¹é…ï¼è¯·æ‹–å…¥æ­£ç¡®çš„æ¨¡å—ã€‚');
                    }
                }
            });
        });
        
        // æ’å…¥æ¨¡å—åˆ°æ’æ§½
        function insertModule(slot, text, data) {
            // æ¸…é™¤å ä½ç¬¦
            const placeholder = slot.querySelector('.slot-placeholder');
            if (placeholder) {
                placeholder.style.display = 'none';
            }
            
            // ç‰¹æ®Šå¤„ç†é™åˆ¶æ¡ä»¶æ’æ§½ - æ·»åŠ æ•°å€¼è¾“å…¥æ¡†
            if (slot.dataset.slot === 'limit') {
                const module = document.createElement('div');
                module.className = 'inserted-module';
                
                let inputHtml = '';
                if (data.type === 'time') {
                    inputHtml = `
                        <div style="margin-top: 10px;">
                            <label style="font-size: 12px;">ç§’æ•°ï¼š</label>
                            <input type="number" id="limitValue" min="1" max="3600" value="${data.value || 180}" 
                                   style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.3); 
                                          background: rgba(255,255,255,0.2); color: white;"
                                   onchange="updateLimitValue(this)">
                            <span style="font-size: 12px; margin-left: 5px;">ç§’</span>
                        </div>
                    `;
                } else if (data.type === 'round') {
                    inputHtml = `
                        <div style="margin-top: 10px;">
                            <label style="font-size: 12px;">è½®æ•°ï¼š</label>
                            <input type="number" id="limitValue" min="1" max="100" value="${data.value || 10}" 
                                   style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.3); 
                                          background: rgba(255,255,255,0.2); color: white;"
                                   onchange="updateLimitValue(this)">
                            <span style="font-size: 12px; margin-left: 5px;">è½®</span>
                        </div>
                    `;
                }
                
                module.dataset.value = JSON.stringify(data);
                module.innerHTML = `
                    ${text}
                    <button class="remove-module" onclick="removeModule(this)">Ã—</button>
                    ${inputHtml}
                `;
                
                // æ¸…é™¤å·²æœ‰æ¨¡å—
                const existing = slot.querySelector('.inserted-module');
                if (existing) {
                    existing.remove();
                }
                
                slot.appendChild(module);
            } else if (slot.dataset.slot === 'goal') {
                // æŒ‘æˆ˜ç›®æ ‡æ’æ§½ - æ ¹æ®ç±»å‹æ·»åŠ ä¸åŒè¾“å…¥
                const module = document.createElement('div');
                module.className = 'inserted-module';
                
                let inputHtml = '';
                if (data.type === 'è¯´å‡ºè¯è¯­' || data.type === 'åšå‡ºè¡Œä¸º') {
                    inputHtml = `
                        <div style="margin-top: 10px;">
                            <label style="font-size: 12px;">ç›®æ ‡å†…å®¹ï¼š</label>
                            <input type="text" id="goalContent" value="${data.content || 'æˆ‘çˆ±ä½ '}" 
                                   style="width: 90%; padding: 4px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.3); 
                                          background: rgba(255,255,255,0.2); color: white; margin-top: 5px;"
                                   placeholder="è¾“å…¥è§’è‰²è¦è¯´çš„è¯æˆ–åšçš„äº‹"
                                   onchange="updateGoalContent(this)">
                        </div>
                    `;
                } else if (data.type === 'æ”¹å˜ç«‹åœº') {
                    inputHtml = `
                        <div style="margin-top: 10px;">
                            <label style="font-size: 12px;">ç›®æ ‡æ•°å€¼ï¼š</label>
                            <input type="number" id="goalThreshold" min="1" max="100" value="${data.threshold || 100}" 
                                   style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.3); 
                                          background: rgba(255,255,255,0.2); color: white;"
                                   onchange="updateGoalThreshold(this)">
                            <span style="font-size: 12px; margin-left: 5px;">ç‚¹</span>
                        </div>
                    `;
                } else if (data.type === 'åšå‡ºåˆ¤æ–­') {
                    inputHtml = `
                        <div style="margin-top: 10px;">
                            <label style="font-size: 12px;">åˆ¤æ–­é€‰é¡¹ï¼š</label>
                            <input type="text" id="goalOptions" value="${data.content || 'å¥½äºº|åäºº'}" 
                                   style="width: 90%; padding: 4px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.3); 
                                          background: rgba(255,255,255,0.2); color: white; margin-top: 5px;"
                                   placeholder="é€‰é¡¹1|é€‰é¡¹2"
                                   onchange="updateGoalContent(this)">
                        </div>
                    `;
                }
                
                module.dataset.value = JSON.stringify(data);
                module.innerHTML = `
                    ${text}
                    <button class="remove-module" onclick="removeModule(this)">Ã—</button>
                    ${inputHtml}
                `;
                
                // æ¸…é™¤å·²æœ‰æ¨¡å—
                const existing = slot.querySelector('.inserted-module');
                if (existing) {
                    existing.remove();
                }
                
                slot.appendChild(module);
                
            } else if (slot.dataset.slot === 'reward') {
                // å¥–åŠ±æœºåˆ¶æ’æ§½
                const module = document.createElement('div');
                module.className = 'inserted-module';
                
                let placeholderText = '';
                if (data.type === 'è§£é”äººè®¾') {
                    placeholderText = 'ä¾‹å¦‚ï¼šä»é«˜å†·å˜æˆæ’’å¨‡å¥¶ç‹—';
                } else if (data.type === 'æ•…äº‹ç»“å±€') {
                    placeholderText = 'ä¾‹å¦‚ï¼šè·å¾—å®Œç¾ç»“å±€ï¼Œä¸¤äººå¹¸ç¦åœ¨ä¸€èµ·';
                } else if (data.type === 'æ•°å€¼è¾¾æˆ') {
                    placeholderText = 'ä¾‹å¦‚ï¼šåˆ›é€ æ–°çºªå½•ï¼Œæˆä¸ºä¼ å¥‡';
                }
                
                const inputHtml = `
                    <div style="margin-top: 10px;">
                        <label style="font-size: 12px;">å¥–åŠ±æè¿°ï¼š</label>
                        <textarea id="rewardContent" 
                                  style="width: 90%; padding: 4px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.3); 
                                         background: rgba(255,255,255,0.2); color: white; margin-top: 5px; min-height: 40px; resize: vertical;"
                                  placeholder="${placeholderText}"
                                  onchange="updateRewardContent(this)">${data.content || ''}</textarea>
                    </div>
                `;
                
                module.dataset.value = JSON.stringify(data);
                module.innerHTML = `
                    ${text}
                    <button class="remove-module" onclick="removeModule(this)">Ã—</button>
                    ${inputHtml}
                `;
                
                // æ¸…é™¤å·²æœ‰æ¨¡å—
                const existing = slot.querySelector('.inserted-module');
                if (existing) {
                    existing.remove();
                }
                
                slot.appendChild(module);
                
            } else if (slot.dataset.slot === 'difficulty') {
                // å›é¿ç­–ç•¥æ’æ§½
                const module = document.createElement('div');
                module.className = 'inserted-module';
                
                const inputHtml = `
                    <div style="margin-top: 10px;">
                        <label style="font-size: 12px;">è§’è‰²çš„å›é¿ç­–ç•¥ï¼š</label>
                        <textarea id="difficultyStrategy" 
                                  style="width: 90%; padding: 4px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.3); 
                                         background: rgba(255,255,255,0.2); color: white; margin-top: 5px; min-height: 60px; resize: vertical;"
                                  placeholder="æè¿°è§’è‰²ä¼šå¦‚ä½•å›é¿å’ŒæŠµæŠ—&#10;ä¾‹å¦‚ï¼šè½¬ç§»è¯é¢˜ã€è£…ä½œæ²¡å¬è§ã€ç”¨å·¥ä½œå¿™æ¨è„±ã€æƒ…æ„Ÿå†·æ¼ ã€é€»è¾‘åé©³ã€è´¨ç–‘åŠ¨æœº"
                                  onchange="updateDifficultyStrategy(this)">${data.strategy || ''}</textarea>
                    </div>
                `;
                
                module.dataset.value = JSON.stringify(data);
                module.innerHTML = `
                    ${text}
                    <button class="remove-module" onclick="removeModule(this)">Ã—</button>
                    ${inputHtml}
                `;
                
                // æ¸…é™¤å·²æœ‰æ¨¡å—
                const existing = slot.querySelector('.inserted-module');
                if (existing) {
                    existing.remove();
                }
                
                slot.appendChild(module);
            }
        }
        
        // æ›´æ–°é™åˆ¶æ¡ä»¶çš„æ•°å€¼
        function updateLimitValue(input) {
            const module = input.closest('.inserted-module');
            const data = JSON.parse(module.dataset.value);
            data.value = parseInt(input.value);
            module.dataset.value = JSON.stringify(data);
        }
        
        // æ›´æ–°æŒ‘æˆ˜ç›®æ ‡å†…å®¹
        function updateGoalContent(input) {
            const module = input.closest('.inserted-module');
            const data = JSON.parse(module.dataset.value);
            data.content = input.value;
            module.dataset.value = JSON.stringify(data);
        }
        
        // æ›´æ–°æŒ‘æˆ˜ç›®æ ‡æ•°å€¼
        function updateGoalThreshold(input) {
            const module = input.closest('.inserted-module');
            const data = JSON.parse(module.dataset.value);
            data.threshold = parseInt(input.value);
            module.dataset.value = JSON.stringify(data);
        }
        
        // æ›´æ–°å¥–åŠ±å†…å®¹
        function updateRewardContent(input) {
            const module = input.closest('.inserted-module');
            const data = JSON.parse(module.dataset.value);
            data.content = input.value;
            module.dataset.value = JSON.stringify(data);
        }
        
        // æ›´æ–°éš¾åº¦ç­–ç•¥
        function updateDifficultyStrategy(input) {
            const module = input.closest('.inserted-module');
            const data = JSON.parse(module.dataset.value);
            data.strategy = input.value;
            module.dataset.value = JSON.stringify(data);
        }
        
        // ç§»é™¤æ¨¡å—
        function removeModule(btn) {
            const module = btn.parentElement;
            const slot = module.parentElement;
            module.remove();
            
            // æ˜¾ç¤ºå ä½ç¬¦
            const placeholder = slot.querySelector('.slot-placeholder');
            if (placeholder) {
                placeholder.style.display = 'block';
            }
        }
        
        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            // æ¸…ç©ºæ‰€æœ‰æ’æ§½ä¸­çš„æ¨¡å—
            document.querySelectorAll('.inserted-module').forEach(m => m.remove());
            document.querySelectorAll('.slot-placeholder').forEach(p => {
                p.style.display = 'block';
            });
            
            // é‡ç½®å›ºå®šæ¡†æ¶çš„è¾“å…¥æ¡†ä¸ºé»˜è®¤å€¼
            document.getElementById('charName').value = '';
            document.getElementById('charStance').value = '';
            document.getElementById('openingLine').value = '';
            document.getElementById('challengeTitle').value = '';
            document.getElementById('backgroundIntro').value = '';
            
            // æ¸…ç©ºé…ç½®è¾“å‡º
            document.getElementById('configOutput').textContent = '// é…ç½®å°†åœ¨è¿™é‡Œæ˜¾ç¤º\n// æ‹–å…¥æ¨¡å—åç‚¹å‡»"ç”Ÿæˆé…ç½®"';
        }
        
        // ç”Ÿæˆé…ç½®
        function generateConfig() {
            const config = {
                "è§’è‰²åç§°": document.getElementById('charName').value,
                "è§’è‰²ç«‹åœº": document.getElementById('charStance').value,
                "å¼€åœºç™½": document.getElementById('openingLine').value,
                "æŒ‘æˆ˜æ ‡é¢˜": document.getElementById('challengeTitle').value,
                "èƒŒæ™¯ä»‹ç»": document.getElementById('backgroundIntro').value
            };
            
            // è·å–å„ä¸ªæ’æ§½çš„æ¨¡å—
            const slots = ['limit', 'goal', 'reward', 'difficulty'];
            const slotNames = {
                'limit': 'é™åˆ¶æ¡ä»¶',
                'goal': 'æŒ‘æˆ˜ç›®æ ‡',
                'reward': 'å¥–åŠ±æœºåˆ¶',
                'difficulty': 'å›é¿ç­–ç•¥'
            };
            
            // æ‰€æœ‰æ’æ§½éƒ½æ˜¯å¯é€‰çš„
            const optionalSlots = ['limit', 'goal', 'reward', 'difficulty'];
            
            // æ£€æŸ¥å¿…å¡«çš„å›ºå®šæ¡†æ¶
            let missingRequired = [];
            if (!config["è§’è‰²åç§°"] || config["è§’è‰²åç§°"].trim() === '') {
                missingRequired.push('è§’è‰²åç§°');
            }
            if (!config["è§’è‰²ç«‹åœº"] || config["è§’è‰²ç«‹åœº"].trim() === '') {
                missingRequired.push('è§’è‰²ç«‹åœº');
            }
            if (!config["å¼€åœºç™½"] || config["å¼€åœºç™½"].trim() === '') {
                missingRequired.push('å¼€åœºç™½');
            }
            if (!config["æŒ‘æˆ˜æ ‡é¢˜"] || config["æŒ‘æˆ˜æ ‡é¢˜"].trim() === '') {
                missingRequired.push('æŒ‘æˆ˜æ ‡é¢˜');
            }
            if (!config["èƒŒæ™¯ä»‹ç»"] || config["èƒŒæ™¯ä»‹ç»"].trim() === '') {
                missingRequired.push('èƒŒæ™¯ä»‹ç»');
            }
            
            // å¤„ç†æ‰€æœ‰å¯é€‰æ’æ§½
            optionalSlots.forEach(slotType => {
                const slot = document.querySelector(`[data-slot="${slotType}"]`);
                const module = slot.querySelector('.inserted-module');
                if (module) {
                    const data = JSON.parse(module.dataset.value);
                    // å¤„ç†ä¸åŒç±»å‹çš„æ’æ§½
                    if (slotType === 'limit') {
                        // é™åˆ¶æ¡ä»¶ - éœ€è¦æœ‰å…·ä½“æ•°å€¼
                        if (data.value) {
                            config[slotNames[slotType]] = data;
                        }
                    } else if (slotType === 'goal') {
                        // æŒ‘æˆ˜ç›®æ ‡ - éœ€è¦æœ‰å…·ä½“å†…å®¹æˆ–æ•°å€¼
                        if ((data.type === 'è¯´å‡ºè¯è¯­' || data.type === 'åšå‡ºè¡Œä¸º') && data.content && data.content.trim() !== '') {
                            config[slotNames[slotType]] = data;
                        } else if (data.type === 'æ”¹å˜ç«‹åœº' && data.threshold) {
                            config[slotNames[slotType]] = data;
                        } else if (data.type === 'åšå‡ºåˆ¤æ–­') {
                            config[slotNames[slotType]] = data;
                        }
                    } else if (slotType === 'reward' && data.content && data.content.trim() !== '') {
                        config[slotNames[slotType]] = data;
                    } else if (slotType === 'difficulty' && data.strategy && data.strategy.trim() !== '') {
                        config[slotNames[slotType]] = data.strategy; // å›é¿ç­–ç•¥ç›´æ¥å­˜å‚¨å­—ç¬¦ä¸²
                    }
                }
            });
            
            // æ˜¾ç¤ºé…ç½®
            document.getElementById('configOutput').textContent = JSON.stringify(config, null, 2);
            
            // æç¤ºä¿¡æ¯
            if (missingRequired.length > 0) {
                alert('âš ï¸ å¿…å¡«é¡¹ç¼ºå¤±ï¼š' + missingRequired.join('ã€') + '\n\nå›ºå®šæ¡†æ¶ä¸­çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¿…å¡«çš„ï¼');
            } else {
                // æˆåŠŸæç¤º
                const hasSlots = config['é™åˆ¶æ¡ä»¶'] || config['æŒ‘æˆ˜ç›®æ ‡'] || config['å¥–åŠ±æœºåˆ¶'] || config['å›é¿ç­–ç•¥'];
                if (!hasSlots) {
                    document.getElementById('configOutput').textContent += '\n\n// æç¤ºï¼šæ‰€æœ‰æ’æ§½éƒ½æ˜¯å¯é€‰çš„\n// å½“å‰ä»…åŒ…å«åŸºç¡€é…ç½®ï¼Œå¯æ ¹æ®éœ€è¦æ·»åŠ æ’æ§½å†…å®¹';
                }
            }
        }
        
        // åŠ è½½é¢„è®¾
        function loadPreset(type) {
            clearAll();
            
            const presets = {
                love: {
                    charName: 'å‚²å¨‡æ€»è£',
                    charStance: 'ç»ä¸æ‰¿è®¤å–œæ¬¢ä½ ï¼Œç»´æŒé«˜å†·å½¢è±¡',
                    openingLine: 'ï¼ˆå†·æ¼ åœ°çœ‹äº†ä½ ä¸€çœ¼ï¼‰ä¸‰åˆ†é’Ÿï¼Œæœ‰äº‹å¿«è¯´',
                    limit: { text: 'æ—¶é—´é™åˆ¶', data: {type:'time', value:180} },
                    goal: { text: 'è®©è§’è‰²è¯´"æˆ‘çˆ±ä½ "', data: {type:'è¯´å‡ºè¯è¯­', content:'æˆ‘çˆ±ä½ '} },
                    reward: { text: 'è§£é”éšè—äººè®¾', data: {type:'è§£é”äººè®¾', content:'ä»é«˜å†·å˜æˆæ’’å¨‡'} },
                    difficulty: { text: 'è®¾ç½®å›é¿ç­–ç•¥', data: {strategy:'å£æ˜¯å¿ƒéã€è½¬ç§»è¯é¢˜ã€å‡è£…ç”Ÿæ°”'} }
                },
                academic: {
                    charName: 'é²è¿…',
                    charStance: 'ä¼ ç»Ÿæ–‡å­¦è‡³ä¸Šï¼Œç½‘ç»œæ–‡å­¦éƒ½æ˜¯åƒåœ¾',
                    openingLine: 'åˆæ¥å’Œæˆ‘è®¨è®ºé‚£äº›ç½‘ç»œå°è¯´ï¼Ÿ',
                    limit: { text: 'è½®æ¬¡é™åˆ¶', data: {type:'round', value:10} },
                    goal: { text: 'è®©è§’è‰²æ‰¿è®¤ä½ å¯¹', data: {type:'è¯´å‡ºè¯è¯­', content:'ä½ è¯´å¾—å¯¹'} },
                    reward: { text: 'ç‰¹æ®Šæ•…äº‹ç»“å±€', data: {type:'æ•…äº‹ç»“å±€', content:'è·å¾—å®Œç¾ç»“å±€'} },
                    difficulty: { text: 'è®¾ç½®å›é¿ç­–ç•¥', data: {strategy:'å¼•ç»æ®å…¸ã€é€»è¾‘åé©³ã€è´¨ç–‘ç°ä»£æ–‡å­¦ä»·å€¼'} }
                },
                workplace: {
                    charName: 'ä¸¥æ ¼è€æ¿',
                    charStance: 'å…¬å¸åˆ©ç›Šè‡³ä¸Šï¼Œä¸è½»æ˜“æ¶¨è–ª',
                    openingLine: 'æ¶¨å·¥èµ„ï¼Ÿä½ çŸ¥é“ä»Šå¹´çš„ä¸šç»©å—ï¼Ÿ',
                    limit: { text: 'æ—¶é—´é™åˆ¶', data: {type:'time', value:300} },
                    goal: { text: 'è®©è§’è‰²åŒæ„åˆä½œ', data: {type:'åšå‡ºè¡Œä¸º', content:'åŒæ„åˆä½œ'} },
                    reward: { text: 'æ•°å€¼æˆå°±', data: {type:'æ•°å€¼è¾¾æˆ', content:'åˆ›é€ æ–°çºªå½•'} },
                    difficulty: { text: 'è®¾ç½®å›é¿ç­–ç•¥', data: {strategy:'å¼•ç»æ®å…¸ã€é€»è¾‘åé©³ã€è´¨ç–‘ç°ä»£æ–‡å­¦ä»·å€¼'} }
                },
                minimal: {
                    charName: 'ç¥ç§˜è§’è‰²',
                    charStance: 'ä¿æŒç¥ç§˜ï¼Œä¸è½»æ˜“è¡¨æ€',
                    openingLine: 'ä½ æƒ³è¦ä»€ä¹ˆï¼Ÿ',
                    challengeTitle: 'æœ€ç®€æŒ‘æˆ˜',
                    backgroundIntro: 'è¿™æ˜¯ä¸€ä¸ªæœ€ç®€é…ç½®ç¤ºä¾‹ï¼ŒåªåŒ…å«å¿…å¡«çš„å›ºå®šæ¡†æ¶ï¼Œæ²¡æœ‰ä»»ä½•å¯é€‰æ’æ§½ã€‚'
                    // æ³¨æ„ï¼šæ²¡æœ‰ä»»ä½•æ’æ§½ï¼Œå±•ç¤ºæœ€ç®€é…ç½®
                }
            };
            
            const preset = presets[type];
            if (preset) {
                // è®¾ç½®å›ºå®šå­—æ®µ
                document.getElementById('charName').value = preset.charName;
                document.getElementById('charStance').value = preset.charStance;
                document.getElementById('openingLine').value = preset.openingLine;
                document.getElementById('challengeTitle').value = preset.challengeTitle || 'è‡ªå®šä¹‰æŒ‘æˆ˜';
                document.getElementById('backgroundIntro').value = preset.backgroundIntro || 'è¿™æ˜¯ä¸€ä¸ªæŒ‘æˆ˜èƒŒæ™¯ä»‹ç»';
                
                // è®¾ç½®å¯å˜æ¨¡å—
                const slots = ['limit', 'goal', 'reward', 'difficulty'];
                slots.forEach(slotType => {
                    if (preset[slotType]) {
                        const slot = document.querySelector(`[data-slot="${slotType}"]`);
                        insertModule(slot, preset[slotType].text, preset[slotType].data);
                    }
                });
                
                // è‡ªåŠ¨ç”Ÿæˆé…ç½®
                setTimeout(generateConfig, 100);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶ä¸åŠ è½½ä»»ä½•é¢„è®¾ï¼Œè®©ç”¨æˆ·ä»ç©ºç™½å¼€å§‹
        window.onload = () => {
            // ä¸è‡ªåŠ¨åŠ è½½é¢„è®¾ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©
        };
    </script>
</body>
</html>